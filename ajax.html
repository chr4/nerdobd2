<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">
<html>
<head>
<title>AJAX test</title>
</head>
<script type="text/javascript">

function update_variable(varname)
{
    var req = false;
    
    // we only need support firefox / konqueror
	req = new XMLHttpRequest();

	req.open("POST", "update_" + varname, true);
    req.onreadystatechange = function()
    {
        if (req.readyState == 4)
        {
            // check if variable is valid (if not, don't update
            if (req.responseText)
                document.getElementById(varname).innerHTML = req.responseText;
            else
                // put code here to grey out not updated value
                ;
        }
    }
    // send newline to request variable
    req.send('\n');
}

// show image tmp in img after it is completely loaded
function image_loaded(tmp, img)
{

    if (tmp.complete)
    {
        // show image
        replace = document.getElementById("img_" + img);
        replace.src = tmp.src;
    }
    else
    {
        // check again in 10ms
        setTimeout("image_loaded(" + tmp + "," + img + ")", 10);
    }
}


function update_image(imagename)
{
    tmp = new Image();
    tmp.style.visibility = 'hidden';

    tmp.src = "/" + imagename + ".png?" + Date.parse(new Date());
    
    image_loaded(tmp, imagename);
}


function update_all()
{
    update_variable("con_km");
    update_variable("speed");
    update_variable("load");
    update_variable("con_h");
    update_variable("temp1");
    update_variable("temp2");
    update_variable("voltage");
    
    update_image("speed");
    update_image("consumption");
    
    // restart timer
    setTimeout ( "update_all()", 500 );
}

/*
 * better would be:
 * /request_variable
 * then send varname
 * parse varname and reply with value
 */

</script>








<style type="text/css">
#con_km {
	font-family: Arial;
	font-size: 70px;
	line-height: 18px;
	color: #ff0000;
}
#speed {
	font-family: Arial;
	font-size: 70px;
	line-height: 18px;
	color: #003862;
}
.small {
    position:absolute;
    top:200px;
    left:20px;
	font-family: Arial;
	font-size: 18px;
	color: #009900;

}
.graph_consumption {
    position:absolute;
    top:20;
    left:300px;
}
.graph_speed {
    position:absolute;
    top:200;
    left:300px;
}

</style>


<body onload="update_all();">

<span id="debug">---</span>
<br/><br/><br/>
<div style="font-size:28px">
<span id="con_km">-.--</span>l/100km<br/><br/>
<span id="speed">-.-</span>km/h
</div>
<div class="small">
  <span id="load">-</span> %<br>
  <span id="con_h">-.--</span> l/h<br>
  <span id="temp1">-.-</span> C<br>
  <span id="temp2">-.-</span> C<br>
  <span id="voltage">-.--</span> V<br>
</div>

<div class="graph_consumption">
  <img id="img_consumption" src="consumption.png"/>
</div>

<div class="graph_speed">
  <img id="img_speed" src="speed.png"/>
</div>

<br/><br/>
</body>
</html>
