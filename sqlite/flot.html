<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>nerdobd2</title>
  <script language="javascript" type="text/javascript" src="js/jquery.min.js"></script>
  <script language="javascript" type="text/javascript" src="js/jquery.flot.min.js"></script>

 </head>
  <body>
    <div id="graphs">
      <div id="graph_consumption" style="width:470px;height:150px"></div>
      <div id="graph_speed" style="width:470px;height:150px"></div>
    </div>

    <div id="data" style="position:fixed;top:0px;left:500px;float:right;font-size:58px">
      <div id="rpm"></div>
      <div id="speed"></div>
      <div id="per_km"></div>
    </div>

<script type="text/javascript">
$(function () {

    function getData() {

        function onDataReceived(json) {
            var now = (new Date()).getTime();

            var options_consumption = {
                // drawing is faster without shadows
                "series": { "shadowSize": 0 },
                "yaxis": { "min": 0, "max": "20" },
                "xaxis": { "min": now - json.timespan_consumption,
                           "max": now,
                           "mode": "time",
                           "timeformat": "%H:%M"
                }
            };

            var options_speed = {
                // drawing is faster without shadows
                "series": { "shadowSize": 0 },
                "yaxis": { "min": 0, "max": "160" },
                "xaxis": { "min": now - json.timespan_speed,
                           "max": now,
                           "mode": "time",
                           "timeformat": "%H:%M"
                }
            };

            $("#rpm").html(json.latest_data.rpm.toFixed(0) + " rpm");
            $("#speed").html(json.latest_data.speed.toFixed(1) + " km/h");
            $("#per_km").html(json.latest_data.per_km.toFixed(2) + " l/km");

            $.plot($("#graph_consumption"), [ json.graph_speed ], options_speed);
            $.plot($("#graph_speed"), [ json.graph_consumption ], options_consumption);
        }

        $.ajax({
            url: "data.json",
            method: 'GET',
            dataType: 'json',
            success: onDataReceived
        });

        setTimeout(getData, 500);
    }

    getData();
});
</script>

 </body>
</html>

